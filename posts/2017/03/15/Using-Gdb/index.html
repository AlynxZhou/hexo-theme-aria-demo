<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript" src="/js/animate.js"></script>
    <title>使用GDB进行简单的C语言程序调试 | 喵's StackHarbor</title>
  </head>
  <body>
    
<header id="header" class="header">
  <div class="container">
    <div class="header-box">
      <div class="logo">
        <img src="/images/ARIA_logo.png" alt="logo">
      </div>
      <div class="header-title">
        <h1 class="title"><a href="/">喵's StackHarbor</a></h1>
        <h2 class="subtitle">Whisper to the World</h2>
      </div>
    </div>
    
<nav id="nav" class="nav">
  <a id="nav-toggle" class="nav-toggle"><i class="fas fa-bars"></i></a>
  <ul id="menu">
    
    <li class="menu-item"><a href="/" >Index</a></li>
    
    <li class="menu-item"><a href="/archives/" >Archives</a></li>
    
    <li class="menu-item"><a href="/categories/" >Categories</a></li>
    
    <li class="menu-item"><a href="/tags/" >Tags</a></li>
    
    <li class="menu-item"><a href="/about/" >About</a></li>
    
  </ul>
</nav>


  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-body">
          <div class="content">
            
<section id="post-content" class="post-content">
  
  <article class="post animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://sh.alynx.xyz/posts/2017/03/15/Using-Gdb/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
       <meta itemprop="name" content="AlynxZhou">
       <meta itemprop="description" content="Whisper to the World">
       <meta itemprop="image" content="/images/Future_Gazer.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="喵's StackHarbor">
      </span>
    </div>
    <header class="post-header">
      <h3 class="post-title" itemprop="name headline">
       <span class="">使用GDB进行简单的C语言程序调试</span>
      </h3>
      <div class="post-meta">
       
       <span class="post-date">
        <i class="far fa-calendar-plus"></i> <time title="post-date" itemprop="dateCreated datePublished" datetime="2017-03-15T19:24:33+08:00">2017-03-15</time>
       </span>
       
       
       <span class="post-meta-divider"> | </span>
       <span class="post-categories">
        <i class="far fa-folder-open"></i>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/编程/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/编程/C语言/" itemprop="url" rel="index"><span itemprop="name">C语言</span></a></span>
        
       </span>
       
       
      </div>
    </header>
    <main class="post-body" itemprop="articleBody">
      <p>事实证明有时候无聊的东西反而变成了一篇博文，谁叫恶趣味的C语言作业非要求用word写实验报告，本猹宁可先写成Markdown再复制粘贴过去。</p>
<a id="more"></a>
<p>首先按照惯例应该介绍下GDB，搭配GCC使用的调试器，也是众多使用GCC为编译器的IDE的默认调试器（大概？），虽然无聊的实验报告模板还很搞笑的写了一个部分叫XXX调试器和VC6.0的比较（看戏的内心：我看过两年学生出生时间比VC6还晚的时候这些课还怎么拿VC6讲）。</p>
<p>所以掌握GDB的使用还是很有必要的，毕竟掌握某个使用GDB的IDE终究只是掌握了一个图形壳子，原理估计还是要深入一层到直接用GDB（强行接入正经模式）。</p>
<p>这里只是按照实验报告的要求写一下断点调试和单步执行的用法（PS：Word实在是太难用了，字号缩进和标题序号就没有按照我想要的方式工作过。</p>
<hr>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="调试模式编译程序"><a href="#调试模式编译程序" class="headerlink" title="调试模式编译程序"></a>调试模式编译程序</h2><p>首先应该明确调试的实现方式，GDB能够暂时的停下程序操作程序其实是通过向编译过程中的二进制流中添加钩子（HOOKS）来实现的。但是对于一个正常的，打算释出给用户使用的程序而言不应该以调试模式编译，因为这些添加进去的钩子不但会增大文件体积，还会降低程序的运行效率。所以GCC默认编译程序的时候时不会添加这个钩子的，需要的时候以<code>-g</code>参数来启用调试模式。</p>
<p>本例中以文件<a href="/posts/2017/03/15/Using-Gdb/Lab2.c">Lab2.c</a>为例，使用命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -std=c11 -g -o lab Lab2.c</span><br></pre></td></tr></table></figure>
<p>将它编译到可执行文件lab。</p>
<h2 id="用GDB打开程序。"><a href="#用GDB打开程序。" class="headerlink" title="用GDB打开程序。"></a>用GDB打开程序。</h2><p>打开程序的命令很简单，就是<code>$ gdb lab</code>，但是有可能遇到的问题是程序要处理命令行参数，在使用GDB的时候是不能直接在命令行后面附加程序参数的，需要使用参数可以在打开GDB之后输入<code>set args 参数1 参数2 ...</code>附加上参数。</p>
<p>用GDB打开程序之后是一个交互界面，显示了一些信息和<code>(gdb)</code>这个提示符，表示你现在是在和GDB进行交互而不是程序。这个时候程序是不会运行的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GNU gdb (GDB) 7.12.1</span><br><span class="line">Copyright (C) 2017 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class="line">and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-pc-linux-gnu&quot;.</span><br><span class="line">Type &quot;show configuration&quot; for configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For help, type &quot;help&quot;.</span><br><span class="line">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...</span><br><span class="line">Reading symbols from lab...done.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><h2 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h2><p>首先使用<code>break</code>指令就可以添加一个断点，断点顾名思义就是程序运行到这个位置会暂停下来交给GDB，这样你才能够在程序运行到一半的时候查看一些可疑的变量，断点是针对函数使用的，比如我想在所有的printf()进入的时候暂停，可以使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break printf</span><br></pre></td></tr></table></figure>
<p>显示的是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break printf</span><br><span class="line">Breakpoint 1 at 0x400540</span><br></pre></td></tr></table></figure>
<p>当然接下来可以继续添加更多的断点。</p>
<p>然后使用<code>run</code>就可以让程序跑起来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/alynx/Homework/实验材料（学生版）/实验2/lab</span><br><span class="line">[实验2说明]本练习运行一个三重for循环, 循环结构如下:</span><br><span class="line">int count = 0;</span><br><span class="line">for(int i=0; j&lt;LoopEnd1; i++)</span><br><span class="line">&#123;</span><br><span class="line">	//第一重循环体</span><br><span class="line">	for(int j=0; j&lt;LoopEnd2; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		//第二重循环体</span><br><span class="line">		for(int s=0; s&lt;LoopEnd3; s++)</span><br><span class="line">		&#123;</span><br><span class="line">			count++;//第三重循环体</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x00007ffff7a86e00 in printf () from /usr/lib/libc.so.6</span><br></pre></td></tr></table></figure>
<p>这时候使用<code>print</code>指令可以打印任意的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print printf</span><br><span class="line">$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0x7ffff7a86e00 &lt;printf&gt;</span><br></pre></td></tr></table></figure>
<p>使用<code>bt</code>指令可以显示出程序的栈（Backtrace）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt</span><br><span class="line">#0  0x00007ffff7a86e00 in printf () from /usr/lib/libc.so.6</span><br><span class="line">#1  0x0000000000400745 in main (argc=1, argv=0x7fffffffe078) at Lab2.c:26</span><br></pre></td></tr></table></figure>
<p>输入<code>c</code>就是继续运行程序的意思。但是<code>step</code>指令的功能更加有用，顾名思义这个就是单步运行，每次只运行一行代码，这是个step-in的模式，即如果该行有函数则进入函数内一行一行运行，而<code>next</code>则是step-over的模式，即如果该行有函数会运行函数返回结果而不是进入函数内部。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) step</span><br><span class="line">Single stepping until exit from function printf,</span><br><span class="line">which has no line number information.</span><br><span class="line">main (argc=1, argv=0x7fffffffe078) at Lab2.c:27</span><br><span class="line">27	    scanf(&quot;%d&quot;, &amp;LoopEnd1);</span><br></pre></td></tr></table></figure>
<p>如果不输入指令直接回车，就是重复上一条指令，程序运行结束之后可以使用<code>quit</code>指令退出GDB。</p>
<hr>
<p>好了本猹要去补作业了。</p>
<p><strong>喵Alynx</strong></p>
<p><em>A Coder &amp; Dreamer</em></p>

    </main>
    <footer class="post-footer">
      
      
      <div class="post-tags">
       
       <a href="/tags/C语言/" rel="tag"># C语言</a>
       
       <a href="/tags/GDB/" rel="tag"># GDB</a>
       
      </div>
      
    </footer>
  </article>
  
  <div class="post-nav animate">
    
    <div class="post-nav-next post-nav-item">
      <a href="/posts/2017/02/23/Sister-s-Noise/" rel="next" title="口琴曲谱：Sister's Noise"><i class="fas fa-angle-left"></i> 口琴曲谱：Sister's Noise</a>
    </div>
    
    <span class="post-nav-divider"></span>
    
    <div class="post-nav-prev post-nav-item">
      <a href="/posts/2017/03/18/Grey-Valentine-s-Day/" rel="prev" title="灰色情人节">灰色情人节 <i class="fas fa-angle-right"></i></a>
    </div>
    
  </div>
  
</section>

          </div>
          
<aside class="sidebar" id="sidebar">
  <a class="sidebar-toggle" id="sidebar-toggle"><i class="fas fa-angle-double-up"></i></a>
  <div class="sidebar-content unfold">
    
<div class="author" id="author">
  
  <img class="author-avatar" src="/images/Future_Gazer.jpg" alt="AlynxZhou">
  
  <p class="author-name">AlynxZhou</p>
  <p class="author-description"> Whisper to the World</p>
</div>

<div class="social-links">
  
  <a href="mailto:alynx.zhou@gmail.com">
    
    <i class="fas fa-envelope"></i>
    
    E-Mail
  </a>
  
  <a href="https://github.com/AlynxZhou/">
    
    <i class="fab fa-github"></i>
    
    GitHub
  </a>
  
  <a href="">
    
    <i class="fab fa-telegram-plane"></i>
    
    Telegram
  </a>
  
  <a href="https://weibo.com/u/5287501461">
    
    <i class="fab fa-weibo"></i>
    
    Weibo
  </a>
  
</div>



    

<hr>
<div class="blogroll">
  <p><i class="fas fa-link"></i> Blog Roll</p>
  <ul>
    
    <li><a href="https://lrscy.github.io/" target="_blank">Meow's Blog</a></li>
    
    <li><a href="http://lgiki.pw/" target="_blank">LGiki's Blog</a></li>
    
    <li><a href="http://hackghost.com/" target="_blank">Hack Ghost's Blog</a></li>
    
    <li><a href="https://jm33.me/" target="_blank">Jm33_m0's Blog</a></li>
    
    <li><a href="http://saigut.com/" target="_blank">Tony Saigut's Blog</a></li>
    
    <li><a href="https://blog.blink.moe/" target="_blank">Blink's Blog</a></li>
    
    <li><a href="http://imchenxy.tk/" target="_blank">Art-Chen's Blog</a></li>
    
    <li><a href="http://blog.voleking.me/" target="_blank">Sugarole</a></li>
    
  </ul>
</div>



    
    


<hr>
<div class="post-toc">
  <p><i class="fas fa-list-ol"></i> Table of Contents</p>
  <div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#调试模式编译程序"><span class="toc-text">调试模式编译程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用GDB打开程序。"><span class="toc-text">用GDB打开程序。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调试"><span class="toc-text">调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#设置断点"><span class="toc-text">设置断点</span></a></li></ol></li></ol></div>
</div>



    
  </div>
</aside>


        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
        <a id="back-to-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <div class="copyright">
      <p><span class="author">AlynxZhou</span> <i class="far fa-copyright"></i> <span class="year">2018 - 2016</span></p>
      <p>由 <a href="https://hexo.io/">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/">ARIA</a></p>
    </div>
  </div>
</footer>


  </body>
</html>
