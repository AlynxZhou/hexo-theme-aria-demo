<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript" src="/js/animate.js"></script>
    <title>Linux下使Steam调用Bumblebee使用独显 | 喵's StackHarbor</title>
  </head>
  <body>
    
<header id="header" class="header">
  <div class="container">
    <div class="header-box">
      <div class="logo">
        <img src="/images/ARIA_logo.png" alt="logo">
      </div>
      <div class="header-title">
        <h1 class="title"><a href="/">喵's StackHarbor</a></h1>
        <h2 class="subtitle">Whisper to the World</h2>
      </div>
    </div>
    
<nav id="nav" class="nav">
  <a id="nav-toggle" class="nav-toggle"><i class="fas fa-bars"></i></a>
  <ul id="menu">
    
    <li class="menu-item"><a href="/" >Index</a></li>
    
    <li class="menu-item"><a href="/archives/" >Archives</a></li>
    
    <li class="menu-item"><a href="/categories/" >Categories</a></li>
    
    <li class="menu-item"><a href="/tags/" >Tags</a></li>
    
    <li class="menu-item"><a href="/about/" >About</a></li>
    
  </ul>
</nav>


  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-body">
          <div class="content">
            
<section id="post-content" class="post-content">
  
  <article class="post animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://sh.alynx.xyz/posts/2017/02/16/Steam-with-Bumblebee/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
       <meta itemprop="name" content="AlynxZhou">
       <meta itemprop="description" content="Whisper to the World">
       <meta itemprop="image" content="/images/Future_Gazer.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="喵's StackHarbor">
      </span>
    </div>
    <header class="post-header">
      <h3 class="post-title" itemprop="name headline">
       <span class="">Linux下使Steam调用Bumblebee使用独显</span>
      </h3>
      <div class="post-meta">
       
       <span class="post-date">
        <i class="far fa-calendar-plus"></i> <time title="post-date" itemprop="dateCreated datePublished" datetime="2017-02-16T12:50:22+08:00">2017-02-16</time>
       </span>
       
       
       <span class="post-meta-divider"> | </span>
       <span class="post-categories">
        <i class="far fa-folder-open"></i>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>
        
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/计算机/Linux/Steam/" itemprop="url" rel="index"><span itemprop="name">Steam</span></a></span>
        
       </span>
       
       
      </div>
    </header>
    <main class="post-body" itemprop="articleBody">
      <p>买了个罗技G502，想想这鼠标狙击键要在fps游戏里才能发挥作用于是入了l4d2的坑，Steam购买，没想到P530核显实在是吃不动这货，FPS上30都很困难，于是研究了一下怎么样调用Bumblebee来使用独显。</p>
<a id="more"></a>
<p>要使用独显首先你得保证你有个独显（这不是废话吗），我的独显是Nvidia Quadro M1000M，虽然是工作站显卡，但是玩游戏应该能达到GTX960左右的性能吧（这卡渲染视频才可怕，但是我不搞多媒体~话说现在新款Precision 5520直接用台式工作站显卡了更可怕），然后你得安装Bumblebee（我只弄过N卡的，A卡不清楚），但是不是简单的安装Bumblebee这个包，按照<a href="https://wiki.archlinux.org/index.php/Bumblebee_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">ArchWiki</a>)，需要安装的包有<code>bumblebee bbswitch primus virtualgl lib32-primus lib32-virtualgl mesa xf86-video-intel nvidia nvidia-settings lib32-nvidia-utils lib32-mesa</code>，各个包的作用在下面：</p>
<ul>
<li>bumblebee</li>
</ul>
<p>主要的程序啦，用来建立一个独立的X服务器做渲染。</p>
<ul>
<li>bbswitch</li>
</ul>
<p>用来切换nvidia卡的开关状态，有了它才能保证不用的时候关闭nvidia卡省电。</p>
<ul>
<li>primus virtualgl</li>
</ul>
<p>这两个分别是不同的桥接器，可以二选一，也可以都用，ArchWiki介绍的是virtualgl的optirun，但是primus是未来的默认选项，性能更好，Steam也推荐用primus。</p>
<ul>
<li>lib32-primus lib32-virtualgl</li>
</ul>
<p>这两个是32位库，因为Steam和大部分上面的游戏都是32位的。</p>
<ul>
<li>mesa xf86-video-intel nvidia nvidia-settings lib32-nvidia-utils lib32-mesa</li>
</ul>
<p>mesa是开源的OpenGL标准实现，另外的则是I卡的驱动（官方开源）和N卡的闭源驱动（性能较好），N卡的设置，以及它们对应的32位库。</p>
<p>接下来将你的用户加入bumblebee组，启动bumblebeed：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># gpasswd -a user bumblebee</span><br><span class="line"># systemctl enable bumblebeed --now</span><br></pre></td></tr></table></figure>
<p>然后测试：</p>
<ul>
<li><p>64位<code>$ optirun glxspheres64</code></p>
</li>
<li><p>32位<code>$ optirun glxspheres32</code></p>
</li>
</ul>
<p>需要独显运行的程序直接用<code>$ optirun %command%</code>就好啦，当然把optirun换成primusrun就是用primus啦。</p>
<p>对于Steam单独的游戏设置，只要在游戏上右键点<em>Properties</em>，打开的窗口选择<code>SET LAUNCH OPTIONS</code>，输入<code>primusrun %command%</code>，运行游戏的时候就是用primusrun运行了。我这里l4d2可以稳定60FPS。</p>
<p>但是还有一些需要启动器启动的，比如Minecraft，采用Hello Minecraft Launcher，用<code>$ optirun java -jar HMCL.jar</code>启动了启动器，但是启动器却不会用optirun去运行游戏本体，解决办法也很简单：</p>
<p>首先<code>$ optirun bash</code>，在这个bash里面用<code>$ optirun java -jar HMCL.jar</code>启动启动器，再打开游戏就是独显啦！</p>
<p><del>本来<code>$ optirun status</code>是应该能查看N卡状态的，但是Arch似乎没法运行这个命令，可以用<code>$ cat /proc/acpi/bbswitch</code>查看ON/OFF。</del>这里是我记错了，应该是用<code>$ optirun --status</code>查看N卡状态。</p>
<p>对于一些版本比较老的bumblebee，optirun开启了独显后没法自动关掉它，是一个bug，手动关闭需要：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rmmod nvidia_modeset nvidia &amp;&amp; sudo tee /proc/acpi/bbswitch &lt;&lt;&lt;OFF</span><br></pre></td></tr></table></figure>
<p>但是新版已经解决了这个bug。</p>
<p>如果你想开启N卡的设置，不能简单地运行nvidia-settings，因为这时候N卡并没有开启，也没有连接到当前的桌面上，使用<code>$ optirun nvidia-settings -c :8</code>就可以开启了。</p>
<p>参考了<a href="https://support.steampowered.com/kb_article.php?ref=6316-GJKC-7437" target="_blank" rel="noopener">Steam的说明</a>，现在剩余的问题就是玩游戏太热了。</p>
<p><strong>喵Alynx</strong></p>
<p><em>A Coder &amp; Dreamer</em></p>

    </main>
    <footer class="post-footer">
      
      
      <div class="post-tags">
       
       <a href="/tags/Linux/" rel="tag"># Linux</a>
       
       <a href="/tags/双显卡/" rel="tag"># 双显卡</a>
       
       <a href="/tags/Bumblebee/" rel="tag"># Bumblebee</a>
       
       <a href="/tags/Steam/" rel="tag"># Steam</a>
       
      </div>
      
    </footer>
  </article>
  
  <div class="post-nav animate">
    
    <div class="post-nav-next post-nav-item">
      <a href="/posts/2017/02/01/Some-Words/" rel="next" title="碎碎念"><i class="fas fa-angle-left"></i> 碎碎念</a>
    </div>
    
    <span class="post-nav-divider"></span>
    
    <div class="post-nav-prev post-nav-item">
      <a href="/posts/2017/02/23/Music-Score/" rel="prev" title="喵的曲谱说明以及目录">喵的曲谱说明以及目录 <i class="fas fa-angle-right"></i></a>
    </div>
    
  </div>
  
</section>

          </div>
          
<aside class="sidebar" id="sidebar">
  <a class="sidebar-toggle" id="sidebar-toggle"><i class="fas fa-angle-double-up"></i></a>
  <div class="sidebar-content unfold">
    
<div class="author" id="author">
  
  <img class="author-avatar" src="/images/Future_Gazer.jpg" alt="AlynxZhou">
  
  <p class="author-name">AlynxZhou</p>
  <p class="author-description"> Whisper to the World</p>
</div>

<div class="social-links">
  
  <a href="mailto:alynx.zhou@gmail.com">
    
    <i class="fas fa-envelope"></i>
    
    E-Mail
  </a>
  
  <a href="https://github.com/AlynxZhou/">
    
    <i class="fab fa-github"></i>
    
    GitHub
  </a>
  
  <a href="">
    
    <i class="fab fa-telegram-plane"></i>
    
    Telegram
  </a>
  
  <a href="https://weibo.com/u/5287501461">
    
    <i class="fab fa-weibo"></i>
    
    Weibo
  </a>
  
</div>



    

<hr>
<div class="blogroll">
  <p><i class="fas fa-link"></i> Blog Roll</p>
  <ul>
    
    <li><a href="https://lrscy.github.io/" target="_blank">Meow's Blog</a></li>
    
    <li><a href="http://lgiki.pw/" target="_blank">LGiki's Blog</a></li>
    
    <li><a href="http://hackghost.com/" target="_blank">Hack Ghost's Blog</a></li>
    
    <li><a href="https://jm33.me/" target="_blank">Jm33_m0's Blog</a></li>
    
    <li><a href="http://saigut.com/" target="_blank">Tony Saigut's Blog</a></li>
    
    <li><a href="https://blog.blink.moe/" target="_blank">Blink's Blog</a></li>
    
    <li><a href="http://imchenxy.tk/" target="_blank">Art-Chen's Blog</a></li>
    
    <li><a href="http://blog.voleking.me/" target="_blank">Sugarole</a></li>
    
  </ul>
</div>



    
    




    
  </div>
</aside>


        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
        <a id="back-to-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <div class="copyright">
      <p><span class="author">AlynxZhou</span> <i class="far fa-copyright"></i> <span class="year">2018 - 2016</span></p>
      <p>由 <a href="https://hexo.io/">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/">ARIA</a></p>
    </div>
  </div>
</footer>


  </body>
</html>
