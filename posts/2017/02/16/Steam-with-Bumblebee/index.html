<!-- build time:Mon Apr 02 2018 15:08:08 GMT+0800 (CST) --><!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#26272b"><meta name="google-site-verification" content="JJdwKdFshbEVpEpykdR95RAumrhPzKrySAMBpknJhao"><meta name="keywords" content="Code, Music, Life, Linux, Arch Linux, Gentoo, JavaScript, ARIA, Hexo"><meta name="msapplication-config" content="/favicons/browserconfig.xml"><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#26272b"><link rel="manifest" href="/favicons/manifest.json"><link rel="alternate" href="/atom.xml" title="喵's StackHarbor" type="application/atom+xml"><link rel="stylesheet" type="text/css" href="/css/index.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/atom-one-dark.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/lightgallery.js@1.0.2/dist/css/lightgallery.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><script defer type="text/javascript" src="/js/util.js"></script><script defer type="text/javascript" src="/js/scrollspy.js"></script><script defer type="text/javascript" src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script><script defer type="text/javascript" src="/js/lightgallery.min.js"></script><script defer type="text/javascript" src="//cdn.jsdelivr.net/npm/lg-fullscreen.js@1.0.0/dist/lg-fullscreen.min.js"></script><script defer type="text/javascript" src="//cdn.jsdelivr.net/npm/lg-hash.js@1.0.0/dist/lg-hash.min.js"></script><script defer type="text/javascript" src="//cdn.jsdelivr.net/npm/lg-pager.js@1.0.0/dist/lg-pager.min.js"></script><script defer type="text/javascript" src="//cdn.jsdelivr.net/npm/lg-thumbnail.js@1.0.0/dist/lg-thumbnail.min.js"></script><script defer type="text/javascript" src="//cdn.jsdelivr.net/npm/lg-zoom.js@1.0.1/dist/lg-zoom.min.js"></script><script defer src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script defer type="text/javascript" src="/js/search.js"></script><script type="text/javascript">$(document).ready(function(){var e="search.xml";0==e.length&&(e="search.xml");var r="/"+e;searchFunc(r,"search-input","search-result")})</script><script defer type="text/javascript" src="/js/index.js"></script><script defer type="text/javascript" src="/js/custom.js"></script><title>Linux下使Steam调用Bumblebee使用独显 | 喵's StackHarbor</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN" data-spy="scroll" data-target=".list-group"><header id="header" class="header"><div class="container"><div class="header-container"><div class="header-title"><h1 class="title"><a href="/">喵's StackHarbor</a></h1><h2 class="subtitle">Whisper to the World</h2></div><div class="logo"><img src="/images/ARIA_logo.png" alt="logo"></div></div><nav id="nav" class="nav"><a id="nav-toggle" class="nav-toggle"><i class="fas fa-bars"></i></a><ul id="menu"><li><a href="/">首页</a></li><li><a href="/archives/">归档</a></li><li><a href="/categories/">分类</a></li><li><a href="/tags/">标签</a></li><li><a href="/about/">关于</a></li></ul></nav></div></header><main id="main" class="main"><div class="container"><div class="main-container"><div class="content"><section id="post" class="post"><article class="post-container card" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://sh.alynx.xyz/posts/2017/02/16/Steam-with-Bumblebee/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="AlynxZhou"><meta itemprop="description" content="Whisper to the World"><meta itemprop="image" content="/images/Future_Gazer_small.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="喵's StackHarbor"></span></div><header class="post-header"><h1 class="post-title" itemprop="name headline"><span>Linux下使Steam调用Bumblebee使用独显</span></h1><div class="post-meta"><span class="post-date"><i class="far fa-calendar-plus"></i> <time title="post-date" itemprop="dateCreated datePublished" datetime="2017-02-16T12:50:22+08:00">2017-02-16</time> </span><span class="post-meta-divider">| </span><span class="post-categories"><i class="far fa-folder-open"></i> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span> <i class="fas fa-angle-right"></i> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span> <i class="fas fa-angle-right"></i> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机/Linux/Steam/" itemprop="url" rel="index"><span itemprop="name">Steam</span></a></span> </span><span class="post-meta-divider">| </span><span class="post-comment-count"><i class="far fa-comments"></i> <a href="/posts/2017/02/16/Steam-with-Bumblebee/#comments" itemprop="discussionUrl"><span class="post-comment-count hc-comment-count" data-xid="posts/2017/02/16/Steam-with-Bumblebee/" itemprop="commentsCount"></span></a></span></div></header><main class="post-body" itemprop="articleBody"><!-- build time:Mon Apr 02 2018 15:08:05 GMT+0800 (CST) --><p>买了个罗技G502，想想这鼠标狙击键要在fps游戏里才能发挥作用于是入了l4d2的坑，Steam购买，没想到P530核显实在是吃不动这货，FPS上30都很困难，于是研究了一下怎么样调用Bumblebee来使用独显。</p><a id="more"></a><p>要使用独显首先你得保证你有个独显（这不是废话吗），我的独显是Nvidia Quadro M1000M，虽然是工作站显卡，但是玩游戏应该能达到GTX960左右的性能吧（这卡渲染视频才可怕，但是我不搞多媒体~话说现在新款Precision 5520直接用台式工作站显卡了更可怕），然后你得安装Bumblebee（我只弄过N卡的，A卡不清楚），但是不是简单的安装Bumblebee这个包，按照<a href="https://wiki.archlinux.org/index.php/Bumblebee_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">ArchWiki</a>)，需要安装的包有<code>bumblebee bbswitch primus virtualgl lib32-primus lib32-virtualgl mesa xf86-video-intel nvidia nvidia-settings lib32-nvidia-utils lib32-mesa</code>，各个包的作用在下面：</p><ul><li>bumblebee</li></ul><p>主要的程序啦，用来建立一个独立的X服务器做渲染。</p><ul><li>bbswitch</li></ul><p>用来切换nvidia卡的开关状态，有了它才能保证不用的时候关闭nvidia卡省电。</p><ul><li>primus virtualgl</li></ul><p>这两个分别是不同的桥接器，可以二选一，也可以都用，ArchWiki介绍的是virtualgl的optirun，但是primus是未来的默认选项，性能更好，Steam也推荐用primus。</p><ul><li>lib32-primus lib32-virtualgl</li></ul><p>这两个是32位库，因为Steam和大部分上面的游戏都是32位的。</p><ul><li>mesa xf86-video-intel nvidia nvidia-settings lib32-nvidia-utils lib32-mesa</li></ul><p>mesa是开源的OpenGL标准实现，另外的则是I卡的驱动（官方开源）和N卡的闭源驱动（性能较好），N卡的设置，以及它们对应的32位库。</p><p>接下来将你的用户加入bumblebee组，启动bumblebeed：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> gpasswd -a user bumblebee</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl <span class="built_in">enable</span> bumblebeed --now</span></span><br></pre></td></tr></table></figure><p>然后测试：</p><ul><li><p>64位<code>$ optirun glxspheres64</code></p></li><li><p>32位<code>$ optirun glxspheres32</code></p></li></ul><p>需要独显运行的程序直接用<code>$ optirun %command%</code>就好啦，当然把optirun换成primusrun就是用primus啦。</p><p>对于Steam单独的游戏设置，只要在游戏上右键点<em>Properties</em>，打开的窗口选择<code>SET LAUNCH OPTIONS</code>，输入<code>primusrun %command%</code>，运行游戏的时候就是用primusrun运行了。我这里l4d2可以稳定60FPS。</p><p>但是还有一些需要启动器启动的，比如Minecraft，采用Hello Minecraft Launcher，用<code>$ optirun java -jar HMCL.jar</code>启动了启动器，但是启动器却不会用optirun去运行游戏本体，解决办法也很简单：</p><p>首先<code>$ optirun bash</code>，在这个bash里面用<code>$ optirun java -jar HMCL.jar</code>启动启动器，再打开游戏就是独显啦！</p><p><del>本来<code>$ optirun status</code>是应该能查看N卡状态的，但是Arch似乎没法运行这个命令，可以用<code>$ cat /proc/acpi/bbswitch</code>查看ON/OFF。</del>这里是我记错了，应该是用<code>$ optirun --status</code>查看N卡状态。</p><p>对于一些版本比较老的bumblebee，optirun开启了独显后没法自动关掉它，是一个bug，手动关闭需要：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rmmod nvidia_modeset nvidia &amp;&amp; sudo tee /<span class="meta">proc</span>/acpi/<span class="keyword">bbswitch </span>&lt;&lt;&lt;OFF</span><br></pre></td></tr></table></figure><p>但是新版已经解决了这个bug。</p><p>如果你想开启N卡的设置，不能简单地运行nvidia-settings，因为这时候N卡并没有开启，也没有连接到当前的桌面上，使用<code>$ optirun nvidia-settings -c :8</code>就可以开启了。</p><p>参考了<a href="https://support.steampowered.com/kb_article.php?ref=6316-GJKC-7437" target="_blank" rel="noopener">Steam的说明</a>，现在剩余的问题就是玩游戏太热了。</p><p><strong>喵Alynx</strong></p><p><em>A Coder &amp; Dreamer</em></p><!-- rebuild by neat --></main><footer class="post-footer"><div class="post-tags"><a class="post-tag button" href="/tags/Linux/" style="background:#fc6423" rel="tag"><i class="fas fa-tags"></i> Linux</a> <a class="post-tag button" href="/tags/双显卡/" style="background:#a3bb54" rel="tag"><i class="fas fa-tags"></i> 双显卡</a> <a class="post-tag button" href="/tags/Bumblebee/" style="background:#47aaff" rel="tag"><i class="fas fa-tags"></i> Bumblebee</a> <a class="post-tag button" href="/tags/Steam/" style="background:#fc6423" rel="tag"><i class="fas fa-tags"></i> Steam</a> <a class="post-tag button" href="/tags/大量标签测试0/" style="background:#a3bb54" rel="tag"><i class="fas fa-tags"></i> 大量标签测试0</a> <a class="post-tag button" href="/tags/大量标签测试1/" style="background:#47aaff" rel="tag"><i class="fas fa-tags"></i> 大量标签测试1</a> <a class="post-tag button" href="/tags/大量标签测试2/" style="background:#fc6423" rel="tag"><i class="fas fa-tags"></i> 大量标签测试2</a> <a class="post-tag button" href="/tags/大量标签测试3/" style="background:#a3bb54" rel="tag"><i class="fas fa-tags"></i> 大量标签测试3</a> <a class="post-tag button" href="/tags/大量标签测试4/" style="background:#47aaff" rel="tag"><i class="fas fa-tags"></i> 大量标签测试4</a></div></footer></article><div class="reward" id="reward"><p>既然看了喵写的文章，不打算投喂一下再走吗？哼！</p><button id="reward-button" disable="enable"><span>打赏</span></button><div id="qr" class="qr" style="display:none"><div id="wechat"><img id="wechat_qr" src="/images/WeChatPay.png" alt="微信支付"> <span>微信支付</span></div><div id="alipay"><img id="alipay_qr" src="/images/AliPay.png" alt="支付宝"> <span>支付宝</span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/2017/02/01/Some-Words/" rel="next" title="碎碎念"><i class="fas fa-angle-left"></i> 碎碎念</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/2017/02/23/Music-Score/" rel="prev" title="喵的曲谱说明以及目录">喵的曲谱说明以及目录 <i class="fas fa-angle-right"></i></a></div></div><div class="comments" id="comments"><div id="hypercomments_widget"></div><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:88578,selector:".hc-comment-count",label:"{%COUNT%}"}),_hcwp.push({widget:"Stream",widget_id:88578,xid:"posts/2017/02/16/Steam-with-Bumblebee/"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var e=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/88578/"+e+"/widget.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a.nextSibling)}}()</script></div></section></div><aside class="sidebar" id="sidebar"><div class="search"><div class="form-group"><i class="fas fa-search"></i> <input type="text" id="search-input" name="q" results="0" placeholder="搜索" class="form-control"></div></div><div class="search-result-box" id="search-result"></div><div class="author sidebar-item" id="author"><img class="author-avatar" src="/images/Future_Gazer_small.png" alt="AlynxZhou"><p class="author-name">AlynxZhou</p><p class="author-description">Whisper to the World</p></div><a class="rss button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i> RSS</a><hr><div class="social-links sidebar-item"><p><i class="far fa-address-card"></i> 社交链接</p><ul><li><i class="fas fa-envelope"></i> <a href="mailto:alynx.zhou@gmail.com" target="_blank">E-Mail</a></li><li><i class="fab fa-github"></i> <a href="https://github.com/AlynxZhou/" target="_blank">GitHub</a></li><li><i class="fab fa-telegram-plane"></i> <a href="https://t.me/AlynxZhou/" target="_blank">Telegram</a></li><li><i class="fab fa-weibo"></i> <a href="https://weibo.com/u/5287501461" target="_blank">Weibo</a></li></ul></div><hr><div class="blogroll sidebar-item"><p><i class="fas fa-link"></i> 友情链接</p><ul><li><a href="https://lrscy.github.io/" target="_blank">Meow's Blog</a></li><li><a href="http://lgiki.pw/" target="_blank">LGiki's Blog</a></li><li><a href="http://hackghost.com/" target="_blank">Hack Ghost's Blog</a></li><li><a href="https://jm33.me/" target="_blank">Jm33_m0's Blog</a></li><li><a href="http://saigut.com/" target="_blank">Tony Saigut's Blog</a></li><li><a href="https://blog.blink.moe/" target="_blank">Blink's Blog</a></li><li><a href="http://imchenxy.tk/" target="_blank">Art-Chen's Blog</a></li><li><a href="http://blog.voleking.me/" target="_blank">Sugarole</a></li></ul></div><hr></aside></div></div></main><footer id="footer" class="footer"><div class="container"><div class="back-to-top"><a id="back-to-top"><i class="fas fa-angle-double-up"></i></a></div><div class="footer-container"><div class="footer-left"><div class="copyright"><span class="author">AlynxZhou</span> <i class="far fa-copyright"></i> <span class="year">2016 - 2018</span> <i class="fab fa-creative-commons"></i> <span class="creative-commons"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a></span></div><div class="busuanzi"><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span> <span id="busuanzi_container_site_uv"><i class="fas fa-user"></i> <span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_page_pv"><i class="far fa-file-alt"></i> <span id="busuanzi_value_page_pv"></span></span></div></div><div class="footer-right"><div class="custom-info">托管于 <i class="fab fa-github-alt"></i> <a href="https://pages.github.com/" target="_blank">GitHub Pages</a></div><div class="powered-by">由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a></div></div></div></div></footer></body></html><!-- rebuild by neat -->